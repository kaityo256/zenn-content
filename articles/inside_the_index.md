---
title: "Gitã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä¸­èº«"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["git"]
published: true
---

## ã¯ã˜ã‚ã«

Gitã¯ã€commitã‚’ã™ã‚‹å‰ã«addã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã¨ã„ã„ã¾ã™ã€‚ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã‚‹å ´æ‰€ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã„ã„ã¾ã™ã€‚å®Ÿä½“ã¯`.git/index`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ã“ã‚ŒãŒã©ã†ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã¡ã‚‡ã£ã¨è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€ã¨ã„ã†è¨˜äº‹ã§ã™ã€‚

## ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

### initç›´å¾Œ

ã¨ã‚Šã‚ãˆãšã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚é©å½“ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ˜ã£ã¦ã€ãã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šã€`git init`ã—ã¾ã™ã€‚

```sh
mkdir index_test
cd index_test
echo "My first file" > test.txt
git init
```

ã•ã¦ã€`git init`ã—ãŸç›´å¾Œã¯ã€ã¾ã `index`ã¯ä½œã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

```sh
$ tree .git
.git
â”œâ”€â”€ HEAD
â”œâ”€â”€ config
â”œâ”€â”€ description
â”œâ”€â”€ hooks
â”‚Â Â  â”œâ”€â”€ applypatch-msg.sample
â”‚Â Â  â”œâ”€â”€ commit-msg.sample
â”‚Â Â  â”œâ”€â”€ fsmonitor-watchman.sample
â”‚Â Â  â”œâ”€â”€ post-update.sample
â”‚Â Â  â”œâ”€â”€ pre-applypatch.sample
â”‚Â Â  â”œâ”€â”€ pre-commit.sample
â”‚Â Â  â”œâ”€â”€ pre-merge-commit.sample
â”‚Â Â  â”œâ”€â”€ pre-push.sample
â”‚Â Â  â”œâ”€â”€ pre-rebase.sample
â”‚Â Â  â”œâ”€â”€ pre-receive.sample
â”‚Â Â  â”œâ”€â”€ prepare-commit-msg.sample
â”‚Â Â  â”œâ”€â”€ push-to-checkout.sample
â”‚Â Â  â””â”€â”€ update.sample
â”œâ”€â”€ info
â”‚Â Â  â””â”€â”€ exclude
â”œâ”€â”€ objects
â”‚Â Â  â”œâ”€â”€ info
â”‚Â Â  â””â”€â”€ pack
â””â”€â”€ refs
    â”œâ”€â”€ heads
    â””â”€â”€ tags

8 directories, 17 files
```

ã¾ãŸã€ã“ã®æ™‚ç‚¹ã§`git diff`ã—ã¦ã‚‚ä½•ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

### addç›´å¾Œ

`git add`ã™ã‚‹ã“ã¨ã§`index`ãŒä½œã‚‰ã‚Œã¾ã™ã€‚

```sh
$ git add test.txt
$ tree .git
.git
â”œâ”€â”€ HEAD
â”œâ”€â”€ config
â”œâ”€â”€ description
(snip)
â”œâ”€â”€ index
â”œâ”€â”€ info
â”‚Â Â  â””â”€â”€ exclude
â”œâ”€â”€ objects
â”‚Â Â  â”œâ”€â”€ 36
â”‚Â Â  â”‚Â Â  â””â”€â”€ 3d8b784900d74b3159e8e93a651c0db42629ef
â”‚Â Â  â”œâ”€â”€ info
â”‚Â Â  â””â”€â”€ pack
â””â”€â”€ refs
    â”œâ”€â”€ heads
    â””â”€â”€ tags

9 directories, 19 files
```

`head`ãŒä½œã‚‰ã‚Œã€`objects`ã®ä¸­ã«ã€`36`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œã‚‰ã‚Œã€ãã®ä¸­ã«`3d8b784900d74b3159e8e93a651c0db42629ef`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã¾ã—ãŸã€‚

ã•ã¦ã€ã“ã®çŠ¶æ…‹ã§ã‚‚ã€`git diff`ã¯ä½•ã‚‚è¡¨ç¤ºã—ã¾ã›ã‚“ã€‚

```sh
$ git diff
$
```

ã“ã“ã¾ã§ã€ä½•ãŒèµ·ããŸã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã¾ãšã€`git add`ã™ã‚‹ã“ã¨ã§ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã®blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½œã‚‰ã‚Œã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä¸­èº«ã¯ã€`git ls-files --stage`ã§è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```sh
$ git ls-files --stage
100644 363d8b784900d74b3159e8e93a651c0db42629ef 0    test.txt
```

`test.txt`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾å¿œã™ã‚‹blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã§ãã¦ã„ã¾ã™ã€‚ãã®ãƒãƒƒã‚·ãƒ¥ã¯`363d8b784900d74b3159e8e93a651c0db42629ef`ã§ã™ã€‚ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’èª¿ã¹ã‚‹ã«ã¯ã€`git cat-file`ã‚’ä½¿ã„ã¾ã™ã€‚`-t`ã§ã‚¿ã‚¤ãƒ—ãŒã€`-p`ã§ä¸­èº«ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```sh
$ git cat-file -t 363d8b784900d74b3159e8e93a651c0db42629ef
blob
$ git cat-file -p 363d8b784900d74b3159e8e93a651c0db42629ef
My first file
```

ãƒãƒƒã‚·ãƒ¥`363...`ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒblobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Šã€ãã®ä¸­èº«ãŒ`My first file`ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã¯`test.txt`ã«å¯¾å¿œã™ã‚‹blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå…¥ã£ã¦ã„ã¾ã™ã€‚`test.txt`ã®ãƒãƒƒã‚·ãƒ¥ã¯`git hash-object`ã§å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```sh
$ git hash-object test.txt
363d8b784900d74b3159e8e93a651c0db42629ef
```

ã¤ã¾ã‚Šã€`git add test.txt`ã‚’ã—ãŸæ™‚ã€Gitã¯

* `test.txt`ã«å¯¾å¿œã™ã‚‹blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«åã¯ãƒãƒƒã‚·ãƒ¥ã¨ã™ã‚‹
* ä½œã‚‰ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯`.git/objects`ã«ä¿å­˜ã€‚ãŸã ã—ã€ãƒãƒƒã‚·ãƒ¥ã®ä¸ŠäºŒæ–‡å­—ã‚’ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã€æ®‹ã‚Šã‚’ãƒ•ã‚¡ã‚¤ãƒ«åã¨ã—ã¦ä»•åˆ†ã‘ã™ã‚‹
* `index`ã«ãã®blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨åå‰ã‚’ç™»éŒ²ã™ã‚‹

ã¨ã„ã†ã“ã¨ã‚’ã—ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€`git diff`ã¯ã€å¼•æ•°ãªã—ã ã¨ã€Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¯”è¼ƒã™ã‚‹ã€ã®ã§ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒç©ºãªã‚‰ä½•ã‚‚è¡¨ç¤ºã›ãšã€`git add`ç›´å¾Œã¯ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã®ã§ã€ã‚„ã¯ã‚Šä½•ã‚‚è¡¨ç¤ºã—ã¾ã›ã‚“ã€‚

### commitç›´å¾Œ

ã•ã¦ã€ã‚³ãƒŸãƒƒãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ git commit -m "Initial commit"
[main (root-commit) fc4050c] Initial commit
 1 file changed, 1 insertion(+)
 create mode 100644 test.txt
```

ç„¡äº‹ã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã€`fc4050c`ã¨ã„ã†ã‚³ãƒŸãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½œã‚‰ã‚Œã¾ã—ãŸã€‚

![index](https://github.com/kaityo256/zenn-content/raw/main/articles/inside_the_index/index.png)

`.git`ãŒã©ã†ãªã£ã¦ã„ã‚‹ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ tree .git
.git
â”œâ”€â”€ COMMIT_EDITMSG
â”œâ”€â”€ HEAD
(snip)
â”œâ”€â”€ index
â”œâ”€â”€ info
â”‚Â Â  â””â”€â”€ exclude
â”œâ”€â”€ logs
â”‚Â Â  â”œâ”€â”€ HEAD
â”‚Â Â  â””â”€â”€ refs
â”‚Â Â      â””â”€â”€ heads
â”‚Â Â          â””â”€â”€ main
â”œâ”€â”€ objects
â”‚Â Â  â”œâ”€â”€ 36
â”‚Â Â  â”‚Â Â  â””â”€â”€ 3d8b784900d74b3159e8e93a651c0db42629ef
â”‚Â Â  â”œâ”€â”€ b4
â”‚Â Â  â”‚Â Â  â””â”€â”€ 0d873c372b28782e7bef9ab962a971b43fc1ca
â”‚Â Â  â”œâ”€â”€ fc
â”‚Â Â  â”‚Â Â  â””â”€â”€ 4050c6ff60e688e052f12fdccec760d0a27503
â”‚Â Â  â”œâ”€â”€ info
â”‚Â Â  â””â”€â”€ pack
â””â”€â”€ refs
    â”œâ”€â”€ heads
    â”‚Â Â  â””â”€â”€ main
    â””â”€â”€ tags

14 directories, 25 files
```

objectsãŒ3ã¤ã«å¢—ãˆã¦ã„ã¾ã™ã€‚ã¾ãŸã€`logs`ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚‚ä½œã‚‰ã‚Œã¾ã—ãŸã€‚ã¾ãšã¯ã“ã®3ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

1ã¤ã¯å…ˆç¨‹ã®blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ`363d8b7`ã§ã—ãŸã€‚ã‚‚ã†1ã¤ã®`fc4050c`ã¯ã‚³ãƒŸãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

```sh
$ git cat-file -t fc4050c
commit
```

ä¸­èº«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ git cat-file -p fc4050c
tree b40d873c372b28782e7bef9ab962a971b43fc1ca
author H. Watanabe <kaityo256@example.com> 1628835374 +0900
committer H. Watanabe <kaityo256@example.com> 1628835374 +0900

Initial commit
```

ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã€treeã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ`b40d873`ã‚’å«ã‚“ã§ã„ã¾ã™ã­ã€‚ã“ã‚ŒãŒtreeã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€ä¸­èº«ã‚‚è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ git cat-file -t b40d873
tree
$ git cat-file -p b40d873
100644 blob 363d8b784900d74b3159e8e93a651c0db42629ef    test.txt
```

`test.txt`ã«å¯¾å¿œã™ã‚‹blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸€ã¤ã ã‘å«ã‚“ã§ã„ã¾ã—ãŸã€‚

ä»¥ä¸Šã‹ã‚‰ã€ãƒ•ã‚¡ã‚¤ãƒ«ä¸€ã¤ã ã‘ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã‚Šã€ã‚³ãƒŸãƒƒãƒˆã—ãŸç›´å¾Œã«ã¯ã€

* ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾å¿œã™ã‚‹blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
* ã‚³ãƒŸãƒƒãƒˆã«å¯¾å¿œã™ã‚‹commitã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
* ã‚³ãƒŸãƒƒãƒˆã®ä¸­ã«ã‚ã‚‹treeã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

ã®3ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½œã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚å…ˆç¨‹ã€`objects`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«3ã¤ã‚ã£ãŸã®ã¯ã“ã‚Œã§ã™ã€‚

## ãƒ–ãƒ©ãƒ³ãƒåˆ‡ã‚Šæ›¿ãˆã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

`git diff`ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å†…å®¹ã‚’æ¯”è¼ƒã™ã‚‹ã®ã§ã—ãŸã€‚ã§ã¯ã€ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯ã©ã†ãªã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã¾ãšã¯ãƒ–ãƒ©ãƒ³ãƒ`branch_a`ã‚’åˆ‡ã£ã¦ã€ãã“ã«`file_a.txt`ã‚’è¿½åŠ ã€ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ã€‚

```sh
$ git checkout -b branch_a
Switched to a new branch 'branch_a'
$ echo "This is A" > file_a.txt
$ git add file_a.txt
$ git commit -m "adds file_a.txt"
[branch_a 41e4b52] adds file_a.txt
 1 file changed, 1 insertion(+)
 create mode 100644 file_a.txt
```

ã“ã‚Œã§ã€ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã«ã¯`test.txt`ã¨`file_a.txt`ã®äºŒã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚å½“ç„¶ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚‚åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

```sh
$ git ls-files --stage
100644 e32836f4cedd87510bfd2f145bc0696861fdb026 0    file_a.txt
100644 363d8b784900d74b3159e8e93a651c0db42629ef 0    test.txt
```

`file_a.txt`ã®blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå¢—ãˆã¦ã„ã¾ã™ã­ã€‚ãƒãƒƒã‚·ãƒ¥ã‚‚ç¢ºèªã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```sh
$ git hash-object file_a.txt
e32836f4cedd87510bfd2f145bc0696861fdb026
```

åŒã˜ã§ã™ã€‚

ã“ã®çŠ¶æ…‹ã§ã€ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã¾ãšã¯`main`ã«æˆ»ã‚Šã¾ã™ã€‚

```sh
$ git switch main
Switched to branch 'main'
```

ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ git ls-files --stage
100644 363d8b784900d74b3159e8e93a651c0db42629ef 0    test.txt
```

`main`ãƒ–ãƒ©ãƒ³ãƒã«ã¯`test.txt`ã—ã‹ãªã„ã®ã§ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ã‚‹ã®ã‚‚`test.txt`ã®blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã ã‘ã§ã™ã€‚

æ–°ãŸãªãƒ–ãƒ©ãƒ³ãƒ`branch_b`ã‚’åˆ‡ã£ã¦ã€æ­´å²ã‚’åˆ†å²ã•ã›ã¾ã—ã‚‡ã†ã€‚

```sh
$ git checkout -b branch_b
Switched to a new branch 'branch_b'
```

ãƒ•ã‚¡ã‚¤ãƒ«`file_b.txt`ã‚’è¿½åŠ ã—ã€ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ã€‚

```sh
$ echo "This is B" > file_b.txt
$ git add file_b.txt
$ git commit -m "adds file_b.txt"
[branch_b 81085f2] adds file_b.txt
 1 file changed, 1 insertion(+)
 create mode 100644 file_b.txt
```

`git add`ã®æ™‚ç‚¹ã§`file_b.txt`ã«å¯¾å¿œã™ã‚‹blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½œã‚‰ã‚Œã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä¸­èº«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ git ls-files --stage
100644 6a571f63d9d0bce7995b5c08d218370d7ea719a5 0    file_b.txt
100644 363d8b784900d74b3159e8e93a651c0db42629ef 0    test.txt
```

`test.txt`ã¨`file_b.txt`ãŒå…¥ã£ã¦ã„ã¾ã™ã­ã€‚

ã“ã®çŠ¶æ…‹ã§ã€`branch_a`ã«åˆ‡ã‚Šæ›¿ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ git switch branch_a
Switched to branch 'branch_a'
```

ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒ`test.txt`ã¨`file_a.txt`ã«ãªã‚Šã¾ã™ã€‚

```sh
$ ls
file_a.txt  test.txt
```

ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä¸­èº«ã‚‚åŒã˜ã§ã™ã€‚

```sh
$ git ls-files --stage
100644 e32836f4cedd87510bfd2f145bc0696861fdb026 0    file_a.txt
100644 363d8b784900d74b3159e8e93a651c0db42629ef 0    test.txt
```

![index](https://github.com/kaityo256/zenn-content/raw/main/articles/inside_the_index/switch.png)

ã¤ã¾ã‚Šã€ãƒ–ãƒ©ãƒ³ãƒåˆ‡ã‚Šæ›¿ãˆã®éš›ã€ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã ã‘ã§ãªãã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚‚åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒãƒƒã‚·ãƒ¥ãŒåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«

`git hash-object`ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ãŒåŒã˜ãªã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åãŒç•°ãªã£ã¦ã‚‚åŒã˜ãƒãƒƒã‚·ãƒ¥ã‚’è¿”ã—ã¾ã™ã€‚

```sh
$ echo "Hello" > test.txt
$ echo "Hello" > test2.txt
$ git hash-object test.txt test2.txt 
e965047ad7c57865823c7d992b1d046ea66edf78
e965047ad7c57865823c7d992b1d046ea66edf78
```

ãã‚Œã‚’ä¸¡æ–¹`git add`ã—ãŸã‚‰ã©ã†ãªã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§åŒã˜blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‰ãªã„ã‚ˆã†ã«ã€ãªã‚“ã‚‰ã‹ã®å‡¦ç†ãŒãªã•ã‚Œã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿè¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ git init
$ git add test.txt test2.txt 
$ git ls-files --stage
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0   test.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0   test2.txt
```

ç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åãŒã€åŒã˜blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚

```sh
$ tree .git/objects
.git/objects
â”œâ”€â”€ e9
â”‚Â Â  â””â”€â”€ 65047ad7c57865823c7d992b1d046ea66edf78
â”œâ”€â”€ info
â””â”€â”€ pack

3 directories, 1 file
```

ä½œã‚‰ã‚ŒãŸblobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚ä¸€ã¤ã ã‘ã§ã™ã€‚Blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã ã‘ã‚’æ ¼ç´ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å«ã¾ãªã„ãŸã‚ã€ç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã§ã‚‚åŒã˜ä¸­èº«ã§ã‚ã‚Œã°åŒã˜blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãªã‚Šã¾ã™ã€‚

ã§ã¯ã€ã“ã®çŠ¶æ…‹ã§ã‚³ãƒŸãƒƒãƒˆã—ã¾ã—ã‚‡ã†ã€‚

```sh
$ git commit -m "initial commit"
[main (root-commit) 5f5cabe] initial comiit
 2 files changed, 2 insertions(+)
 create mode 100644 test.txt
 create mode 100644 test2.txt
```

ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¯ç›¸å¤‰ã‚ã‚‰ãšåŒã˜blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚

```sh
$ git ls-files --stage
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0   test.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0   test2.txt
```

ä½œã‚‰ã‚ŒãŸã‚³ãƒŸãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ git cat-file -p 5f5cabe
tree 44c2534716a893ea86255ceddaf2afbf9e89b882
author H. Watanabe <kaityo256@example.com> 1628841438 +0900
committer H. Watanabe <kaityo256@example.com> 1628841438 +0900

initial commit
```

ãƒ„ãƒªãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ`44c2534`ãŒã§ãã¦ã„ã‚‹ã®ã§ã€ãã‚Œã‚’è¦‹ã¦ã¿ã¾ã™ã€‚

```sh
$ git cat-file -p 44c2534
100644 blob e965047ad7c57865823c7d992b1d046ea66edf78    test.txt
100644 blob e965047ad7c57865823c7d992b1d046ea66edf78    test2.txt
```

å‡ºåŠ›ãŒã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä¸­èº«ã¨åŒã˜ã§ã™ãŒã€ã“ã„ã¤ãŒãƒ•ã‚¡ã‚¤ãƒ«åã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å¯¾å¿œã‚’å–ã£ã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®inodeã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®é–¢ä¿‚ã«ä¼¼ã¦ã„ã¾ã™ã­ã€‚

ä¸€å¿œ`.git/objects`ã‚‚è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
$ tree .git/objects 
.git/objects
â”œâ”€â”€ 44
â”‚Â Â  â””â”€â”€ c2534716a893ea86255ceddaf2afbf9e89b882
â”œâ”€â”€ 5f
â”‚Â Â  â””â”€â”€ 5cabe1b69ce14a824760db8c00941ed7679f17
â”œâ”€â”€ e9
â”‚Â Â  â””â”€â”€ 65047ad7c57865823c7d992b1d046ea66edf78
â”œâ”€â”€ info
â””â”€â”€ pack

5 directories, 3 files
```

ãƒ•ã‚¡ã‚¤ãƒ«ãŒ2ã¤ã€ã‚³ãƒŸãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ1ã¤ã€ã‚³ãƒŸãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå«ã‚€ãƒ„ãƒªãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒ1ã¤ã§ã€åˆè¨ˆ4ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå¿…è¦ãªæ°—ãŒã—ã¾ã™ãŒã€2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ãŒåŒã˜ãªã®ã§ã€ãã‚Œãã‚ŒãŒåŒã˜blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã—ã¦ãŠã‚Šã€å…¨ä½“ã§3ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã—ã‹ä½œã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ä¸­èº«ãŒåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã„ãã¤ä½œã£ã¦ã‚‚blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä¸€ã¤ã§ã™ã€‚

```sh
$ git ls-files --stage
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0    test.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0    test2.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0    test3.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0    test4.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0    test5.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0    test6.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0    test7.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0    test8.txt
100644 e965047ad7c57865823c7d992b1d046ea66edf78 0    test9.txt
```

ã„ã‚„ã€ã ã‹ã‚‰ã©ã†ã—ãŸã€ã¨è¨€ã‚ã‚Œã¦ã‚‚å›°ã‚Šã¾ã™ãŒã€‚

ã¡ãªã¿ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«å…¥ã£ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å…¨ã¦blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚é©å½“ãªãƒªãƒã‚¸ãƒˆãƒªã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```sh
git ls-files --stage | awk '{print $2}' |xargs -I arg git cat-file -t arg | sort -u
```

`blob`ã¨å‡ºã‚‹ã¯ãšã§ã™ã€‚

## ã¾ã¨ã‚

* ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å®Ÿä½“ã¯`.git/index`ã¨ã„ã†ä¸€ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«
* ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã¯ã€ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã«å¯¾å¿œã—ãŸblobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹
* `git diff`ã‚’å¼•æ•°ãªã—ã§å©ãã¨ã€ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å·®ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ã€ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ãŒã€å¯¾å¿œã—ã¦ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä¸­èº«ã‚‚åˆ‡ã‚Šæ›¿ã‚ã‚‹

ã¡ãªã¿ã«`.git/index`ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯[ã“ã¡ã‚‰](https://github.com/git/git/blob/master/Documentation/technical/index-format.txt)ã€‚æ°—ã«ãªã‚‹äººã¯è§£æã—ã¦ã¿ã‚‹ã¨é¢ç™½ã„ã‹ã‚‚ã€‚

## å‚è€ƒæ–‡çŒ®

* [Pro Git - 10.1 Git Internals](https://git-scm.com/book/en/v2/Git-Internals-Plumbing-and-Porcelain)
* [What does the git index contain EXACTLY? - StackOverflow](https://stackoverflow.com/questions/4084921/what-does-the-git-index-contain-exactly)
