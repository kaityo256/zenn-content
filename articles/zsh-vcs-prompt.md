---
title: "Zshã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«Gitãƒªãƒã‚¸ãƒˆãƒªã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["zsh", "git"]
published: false
---

## æ¦‚è¦

Zshã§Gitãƒªãƒã‚¸ãƒˆãƒªã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹Zshã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚å…·ä½“çš„ã«ã¯

* ãƒ–ãƒ©ãƒ³ãƒåã®è¡¨ç¤º
* çŠ¶æ…‹ã‚’ãƒ–ãƒ©ãƒ³ãƒåã®è‰²ã§è¡¨ç¾
* ä¸Šæµãƒ–ãƒ©ãƒ³ãƒã®æœ‰ç„¡ã¨çŠ¶æ…‹ã‚’è‰²ã§è¡¨ç¾

ã‚’å®Ÿç¾ã—ã¾ã™ã€‚ãŸã ä¸Šè¨˜ã‚’å®Ÿç¾ã—ãŸã„ã ã‘ã®äººã¯ã€vcs_infoã‹git-promptã‚’ä½¿ã£ãŸæ–¹ãŒæ—©ã„ã¨æ€ã„ã¾ã™ã€‚

## ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã„ã˜ã‚‹

Gitã‚„Subversionã®ã‚ˆã†ãªãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ã£ã¦ã„ã‚‹ã¨ã€ãã®ãƒªãƒã‚¸ãƒˆãƒªã®çŠ¶æ…‹ã‚’å¸¸ã«ç¢ºèªã—ãŸããªã‚Šã¾ã™ã€‚Gitãªã‚‰ã€ãƒ–ãƒ©ãƒ³ãƒåã‚„æœªã‚³ãƒŸãƒƒãƒˆã€æœªãƒ—ãƒƒã‚·ãƒ¥ã®çŠ¶æ…‹ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¡¨ç¤ºã—ãŸã„ã§ã™ã­ã€‚ä»–ã«ã‚‚è‡ªåˆ†ãŒrootã‹ã©ã†ã‹ã‚’ã‚ã‹ã‚Šã‚„ã™ãã—ãŸã‚Šãªã©ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã„ã‚ã„ã‚ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã„ã‚‹äººã¯å¤šã„ã¨æ€ã„ã¾ã™ã€‚

ã§ã€å½“ç„¶ã®ã“ã¨ãªãŒã‚‰ãã†ã„ã†ãƒ‹ãƒ¼ã‚ºã®ãŸã‚ã«ã„ã‚ã„ã‚ã‚ã‚‹ã‚ã‘ã§ã™ãŒã€ã›ã£ã‹ããªã®ã§ä¸€ã¤ä¸€ã¤æ©Ÿèƒ½ã‚’ç¢ºèªã—ãªãŒã‚‰ãã†ã„ã†Zshã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’çµ„ã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚

æœ€çµ‚çš„ã«ã€`git-prompt`ã¨ã„ã†é–¢æ•°ã‚’ä½œã‚Šã€ãã‚ŒãŒç¾åœ¨ã®Gitãƒªãƒã‚¸ãƒˆãƒªã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¦ã€ãã®å€¤ã‚’`PROMPT`ãªã‚Š`RPROMPT`ãªã‚Šå¥½ããªã¨ã“ã‚ã«æ”¾ã‚Šè¾¼ã‚€å½¢ã¨ã—ã¾ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚æ§˜ã€…ãªçŠ¶æ…‹ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã‚‹Makeãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã®ã§ã€ãƒ‡ãƒãƒƒã‚°ç›®çš„ã«ã‚‚ä½¿ãˆã‚‹ã¾ã™ã€‚

[https://github.com/kaityo256/zsh_vcs](https://github.com/kaityo256/zsh_vcs)

### é–¢æ•°ã‚’ä½œã‚‹

ã¾ãšã¯é–¢æ•°ã‚’ä½œã£ã¦å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚`function`ã§ä½œã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¾‹ãˆã°`zshrc_git.zsh`ã¨ã„ã†åå‰ã§ä½œã‚Šã¾ã™ã€‚

```sh
function git-prompt{
  echo "main"
}

git-prompt
```

`git-prompt`ã¨ã„ã†é–¢æ•°ã‚’ä½œã‚Šã€ãã‚Œã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```sh
$ source zshrc_git.zsh
main
```

å˜ã«`echo`ãŒå®Ÿè¡Œã•ã‚Œã¦ã€`main`ã¨è¡¨ç¤ºã•ã‚ŒãŸã ã‘ã§ã™ã€‚

### è‰²ã‚’ã¤ã‘ã‚‹

ãƒªãƒã‚¸ãƒˆãƒªã®çŠ¶æ…‹ã‚’è‰²ã§è¡¨ç¾ã—ãŸã„ã®ã§ã€è‰²ã‚’ã¤ã‘ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãã®ãŸã‚ã«ã¯ã€`colors`ã¨ã„ã†ã‚·ã‚§ãƒ«é–¢æ•°ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚

```sh
autoload -U colors; colors
function git-prompt{
  echo "${fg[green]}main${reset_color}"
}

git-prompt
```

ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ç·‘è‰²ã§`main`ã¨è¡¨ç¤ºã•ã‚ŒãŸã¯ãšã§ã™ã€‚

æœ€åˆã®`autoload -U colors; colors`ã¯ã€ã‚·ã‚§ãƒ«é–¢æ•°ã‚’èª­ã¿è¾¼ã‚€ã‚¤ãƒ‡ã‚£ã‚ªãƒ ã§ã™ã€‚`autoload func`ã¯ã€å˜ã«`func`èª­ã¿è¾¼ã‚€ã ã‘ã§å®Ÿè¡Œã—ã¾ã›ã‚“ã€‚ãªã®ã§ã€ã™ãã«ä½¿ã„ãŸã„å ´åˆã¯`autoload func;func`ã¨ã—ã¾ã™ã€‚`autoload -X func`ã¨ã€`-X`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã¨ã™ãã«å®Ÿè¡Œã—ã¦ãã‚Œã¾ã™ãŒã€ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã€ç¾åœ¨è¨­å®šã•ã‚Œã¦ã„ã‚‹aliasã‚’å¼•ãç¶™ãã¾ã™ã€‚`ls`ã‚„`cp`ãªã©ã¯ãƒ¦ãƒ¼ã‚¶å´ã§aliasãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå¤šãã€ãã‚Œã‚’ã‚·ã‚§ãƒ«é–¢æ•°ã®ä¸­ã«å¼•ãç¶™ãã¨èª¤å‹•ä½œã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚ãã“ã§ã€é€šå¸¸ã¯aliasã‚’å¼•ãç¶™ãŒãªã„ã§èª­ã¿è¾¼ã‚€ã‚ªãƒ—ã‚·ãƒ§ãƒ³`-U`ã‚’ã¤ã‘ã¦ã€`autoload -U func`ã¨ã—ã¾ã™ã€‚`-U`ã¨`-X`ã¯åŒæ™‚ã«æŒ‡å®šã§ããªã„ãŸã‚ã€ã™ãã«ä½¿ã„ãŸã‘ã‚Œã°`autoload -U func; func`ã¨ã—ã¾ã™ã€‚

`colors`ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€`fg[è‰²]`ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã°`${fg[green]}`ã¯è‰²ã‚’ç·‘è‰²ã«ã—ã¾ã™ã€‚ãã®ã¾ã¾ã ã¨ä»–ã®è¡¨ç¤ºã‚‚ç·‘è‰²ã®ã¾ã¾ã«ãªã£ã¦ã—ã¾ã†ãŸã‚ã€`${reset_color}`ã§è‰²ã‚’ã‚‚ã¨ã«æˆ»ã—ã¾ã™ã€‚

### ã‚«ãƒ¬ãƒ³ãƒˆãƒ–ãƒ©ãƒ³ãƒåã‚’å–å¾—ã™ã‚‹

ã‚«ãƒ¬ãƒ³ãƒˆãƒ–ãƒ©ãƒ³ãƒã¯`git symbolic-ref --short HEAD`ã§å–ã‚Œã¾ã™ã€‚

```sh
$ git symbolic-ref --short HEAD
main
```

ã¡ãªã¿ã«`--short`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯æ˜”ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç„¡ã—ã ã¨ã“ã‚“ãªè¡¨ç¤ºã«ãªã‚Šã¾ã™ã€‚

```sh
$ git symbolic-ref HEAD
refs/heads/main
```

ã“ã“ã‹ã‚‰ãƒ–ãƒ©ãƒ³ãƒåã‚’å–å¾—ã™ã‚‹ã«ã¯sedã¨ã‹ãŒå¿…è¦ã§ã—ãŸãŒã€ä»Šã¯`--short`ã§å–ã‚Œã‚‹ã®ã§ä¸è¦ã«ãªã‚Šã¾ã—ãŸã€‚

ã¾ãŸã€Gitãƒªãƒã‚¸ãƒˆãƒªã§ã¯ç„¡ã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ç¤ºãŒæ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºã¾ã™ã€‚

```sh
$ git symbolic-ref --short HEAD
fatal: not a git repository (or any of the parent directories): .git
```

ã—ãŸãŒã£ã¦ã€æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã‚’`/dev/null`ã«é£›ã°ã—ã¦ã€æ¨™æº–å‡ºåŠ›ã«ãªã‚“ã‹å‡ºãŸã‚‰ãã‚ŒãŒãƒ–ãƒ©ãƒ³ãƒåã€ãªã«ã‚‚ãªã‘ã‚Œã°Gitãƒªãƒã‚¸ãƒˆãƒªã§ã¯ãªã„ã€ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã“ã“ã§ã¯HEADãŒå–ã‚Œã¦ã„ã‚‹ã“ã¨ã¯æƒ³å®šã—ãªã„ã“ã¨ã«ã—ã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸Šã‚’ã¾ã¨ã‚ã‚‹ã¨ã“ã‚“ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãªã‚Šã¾ã™ã€‚

```sh
autoload -U colors; colors

function git-prompt {
  local branchname
  branchname=`git symbolic-ref --short HEAD 2> /dev/null`
  if [ -z $branchname ]; then
    return
  fi
  echo "${fg[green]}${branchname}${reset_color}"
}

git-prompt
```

### çŠ¶æ…‹ã‚’èª¿ã¹ã‚‹

ãƒ–ãƒ©ãƒ³ãƒåã®è‰²ã§çŠ¶æ…‹ã‚’è¡¨ç¾ã—ã¾ã™ã€‚ã¨ã‚Šã‚ãˆãšæœªã‚³ãƒŸãƒƒãƒˆç„¡ã—ã€Untracked filesã‚‚ç„¡ã—ã®çŠ¶æ…‹ã§ç·‘ã€æœªã‚³ãƒŸãƒƒãƒˆãªã—ã€Untracked filesã‚ã‚Šã§é»„è‰²ã€ãã‚Œä»¥å¤–ã¯èµ¤ã«ã—ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã€`git status`ã‚’å®Ÿè¡Œã—ã¦ã€`nothing to commit, working tree clean`ã¨è¡¨ç¤ºã•ã‚ŒãŸã‚‰ç·‘ã§ã™ã€‚ãã‚Œä»¥å¤–ã§ã€`nothing added to commit but untracked files present (use "git add" to track)`ã¨è¡¨ç¤ºã•ã‚ŒãŸã‚‰é»„è‰²ã€ãã‚Œä»¥å¤–ã¯èµ¤ã§ã™ã­ã€‚ä»¥ä¸Šã‚’ç´ ç›´ã«å®Ÿè£…ã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚

```sh
autoload -U colors; colors

function git-prompt {
  local branchname branch st
  branchname=`git symbolic-ref --short HEAD 2> /dev/null`
  if [ -z $branchname ]; then
    return
  fi
  st=`git status 2> /dev/null`
  if [[ -n `echo "$st" | grep "^nothing to"` ]]; then
    branch="${fg[green]}($branchname)$reset_color"
  elif [[ -n `echo "$st" | grep "^nothing added"` ]]; then
    branch="${fg[yellow]}($branchname)$reset_color"
  else
    branch="${fg[red]}($branchname)$reset_color"
  fi

  echo "$branch"
}

git-prompt
```

æ–°ãŸã«`branch`ã¨`st`ã¨ã„ã†å¤‰æ•°ã‚’å°å…¥ã—ã¾ã—ãŸã€‚`git stutus`ã®å®Ÿè¡Œçµæœã‚’`st`ã«å—ã‘ã€`nothing to`ã¨ã„ã†æ–‡å­—åˆ—ã‚’å«ã‚“ã§ã„ãŸã‚‰ç·‘ã€`nothing added`ã‚’å«ã‚“ã§ã„ãŸã‚‰é»„è‰²ã€ãã‚Œä»¥å¤–ã¯èµ¤ã§ã™ã€‚ã¾ãŸã€ãƒ–ãƒ©ãƒ³ãƒåã‚’ä¸¸æ‹¬å¼§ã§å›²ã¿ã¾ã—ãŸã€‚

ãƒªãƒã‚¸ãƒˆãƒªã§è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚`kaityo256/zsh_vcs`ãƒªãƒã‚¸ãƒˆãƒªã®ä¸­ã®`sample_dir`ã§`make`ã™ã‚‹ã¨ã€ã„ãã¤ã‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã§ãã¾ã™[^1]ã€‚

```sh
git clone https://github.com/kaityo256/zsh_vcs.git 
cd zsh_vcs
cd sample_dir
make
```

ãã‚Œãã‚Œ

* `00` `git init`ã—ãŸç›´å¾Œ(é»„è‰²ã«ãªã‚‹ã¯ãš)
* `01` `git init;git add`ã—ãŸç›´å¾Œ(èµ¤è‰²ã«ãªã‚‹ã¯ãš)
* `02` `git init;git add;git commit`ã—ãŸç›´å¾Œ(ç·‘è‰²ã«ãªã‚‹ã¯ãš)

ã§ã™ã€‚å®Ÿéš›ã«ã€

```sh
cd sample_dir
make
cd 00
source ../../zshrc_git.zsh 
```

ã¨ã‹ã‚„ã£ã¦ã€æƒ³å®šã©ãŠã‚Šã®è‰²ã§ãƒ–ãƒ©ãƒ³ãƒåãŒå‡ºã¦ãã‚‹ã‹ç¢ºèªã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚ã¾ãŸã€ã©ã“ã‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§

```sh
git branch -m hoge
source ../../zshrc_git.zsh 
```

ã¨ã—ã¦ã€ã¡ã‚ƒã‚“ã¨ãƒ–ãƒ©ãƒ³ãƒåãŒå–ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã¿ã‚‹ã®ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

[^1]: Gitãƒªãƒã‚¸ãƒˆãƒªã®ä¸­ã«åˆ¥ã®ãƒªãƒã‚¸ãƒˆãƒªä½œã‚‹ã®ã¯è‰¯ããªã„ã‘ã©ã€ã¾ãè¨±ã—ã¦ã€‚

### ä¸Šæµãƒ–ãƒ©ãƒ³ãƒ

æ¬¡ã«ã€ä¸Šæµãƒ–ãƒ©ãƒ³ãƒã®å–å¾—ã¨ã€ä¸Šæµãƒ–ãƒ©ãƒ³ãƒã¨ã®å·®åˆ†ã‚’èª¿ã¹ã¾ã—ã‚‡ã†ã€‚ä¸Šæµãƒ–ãƒ©ãƒ³ãƒã®å–å¾—æ–¹æ³•ã¯ã„ã‚ã„ã‚ã‚ã‚Šã¾ã™ãŒã€`git config`ã§å–ã‚‹ã®ãŒæ¥½ã§ã™ã€‚`git config branch.ãƒ–ãƒ©ãƒ³ãƒå.remote`ã§ã€ä¸Šæµãƒ–ãƒ©ãƒ³ãƒãŒè¨­å®šã•ã‚Œã¦ã„ã‚Œã°å–ã‚Œã¾ã™ã€‚ä¸Šæµãƒ–ãƒ©ãƒ³ãƒãŒãªã‘ã‚Œã°ä½•ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒã‚’è¡¨ç¤ºã—ã¦ã‚‚è‰¯ã„ã®ã§ã™ãŒã€åƒ•ã¯ã©ã†ã›`origin`ã—ã‹ä½¿ã‚ãªã„ã®ã§ã€ä¸Šæµãƒ–ãƒ©ãƒ³ãƒãŒã‚ã‚Œã°ãƒ–ãƒ©ãƒ³ãƒåã®æ¨ªã«`[up]`ã‚’è¡¨ç¤ºã—ã€ãã®è‰²ã§æœªãƒ—ãƒƒã‚·ãƒ¥ã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã¾ã—ã‚‡ã†ã€‚

ä¸Šæµãƒ–ãƒ©ãƒ³ãƒãŒã‚ã‚‹å ´åˆã€æœªãƒ—ãƒƒã‚·ãƒ¥ã®ã‚³ãƒŸãƒƒãƒˆãŒã‚ã‚‹ã‹ã©ã†ã‹ã¯`git log ä¸Šæµãƒ–ãƒ©ãƒ³ãƒ..ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒ`ã§èª¿ã¹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã‘ã‚Œã°å·®åˆ†ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ä»¥ä¸Šã‚’ã¾ã¨ã‚ã‚‹ã¨ã€ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚

```sh
  remote=`git config branch.${branchname}.remote 2> /dev/null`

  if [ -z $remote ]; then
    pushed=''
  else
    upstream="${remote}/${branchname}"
    if [[ -z `git log ${upstream}..${branchname}` ]]; then
      pushed="${fg[green]}[up]$reset_color"
    else
      pushed="${fg[red]}[up]$reset_color"
    fi
  fi

  echo "$branch$pushed"
```

é›£ã—ã„ã“ã¨ã¯ä½•ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚`pushed`ã¨ã„ã†å¤‰æ•°ã‚’ä½œã‚Šã€

* ä¸Šæµãƒ–ãƒ©ãƒ³ãƒãŒãªã‘ã‚Œã°ç©ºæ–‡å­—åˆ—
* ä¸Šæµãƒ–ãƒ©ãƒ³ãƒãŒã‚ã‚Œã°`[up]`
  * ãƒ­ãƒ¼ã‚«ãƒ«ã¨å·®åˆ†ãŒãªã‘ã‚Œã°ç·‘è‰²
  * ãƒ­ãƒ¼ã‚«ãƒ«ã¨å·®åˆ†ãŒã‚ã‚Œã°èµ¤è‰²

ã«ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚ã¾ãŸ`sample_dir`ã§ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ã‚‡ã†ã€‚ãŸã¨ãˆã°`03`ãªã‚‰

```sh
cd 03
source ../../zshrc_git.zsh 
```

ã¨ã™ã‚‹ã¨ã€ç·‘è‰²ã§`(main)[up]`ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

ãã‚Œãã‚Œã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®çŠ¶æ…‹ã¯ã€

* `03` ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’è¨­å®šã—ã€æœªãƒ—ãƒƒã‚·ãƒ¥ãªã— (ç·‘è‰²ã§`[up]`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš)
* `04` ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’è¨­å®šã—ã€æœªãƒ—ãƒƒã‚·ãƒ¥ãªã— (èµ¤è‰²ã§`[up]`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš)
* `05` ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’è¨­å®šã—ã€æœªã‚³ãƒŸãƒƒãƒˆã‚ã‚Šã€æœªãƒ—ãƒƒã‚·ãƒ¥ãªã— (èµ¤è‰²ã§ãƒ–ãƒ©ãƒ³ãƒåãŒã€ç·‘ã§`[up]`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš)

ã¨ãªã£ã¦ã„ã¾ã™ã€‚

### RPROMPTã«è¨­å®š

ã•ã¦ã€å¾Œã¯å‡ºã¦ããŸæ–‡å­—åˆ—ã‚’PROMPTãªã‚ŠRPROMPTãªã‚Šã«çªã£è¾¼ã‚ã°ã‚ˆã„ã®ã§ã™ãŒã€ãã®ã¾ã¾è¨­å®šã™ã‚‹ã¨è¡¨ç¤ºãŒãŠã‹ã—ããªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€è‰²ã‚’å¤‰ãˆã¦ã„ã‚‹ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã®æ–‡å­—åˆ—ã‚’ã€æ–‡å­—ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ã—ã¾ã£ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚ã“ã‚Œã‚’é˜²ãã«ã¯ã€è‰²ã‚’å¤‰ãˆã‚‹ã¨ã“ã‚ã‚’`%{`ã¨`%}`ã§å›²ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸Šã®ä¿®æ­£ã‚’ã—ãŸã‚‚ã®ãŒä»¥ä¸‹ã§ã™ã€‚

```sh
autoload -U colors; colors

function git-prompt {
  local branchname branch st remote pushed upstream
  branchname=`git symbolic-ref --short HEAD 2> /dev/null`
  if [ -z $branchname ]; then
    return
  fi
  st=`git status 2> /dev/null`
  if [[ -n `echo "$st" | grep "^nothing to"` ]]; then
    branch="%{${fg[green]}%}($branchname)%{$reset_color%}"
  elif [[ -n `echo "$st" | grep "^nothing added"` ]]; then
    branch="%{${fg[yellow]}%}($branchname)%{$reset_color%}"
  else
    branch="%{${fg[red]}%}($branchname)%{$reset_color%}"
  fi

  remote=`git config branch.${branchname}.remote 2> /dev/null`

  if [ -z $remote ]; then
    pushed=''
  else
    upstream="${remote}/${branchname}"
    if [[ -z `git log ${upstream}..${branchname}` ]]; then
      pushed="%{${fg[green]}%}[up]%{$reset_color%}"
    else
      pushed="%{${fg[red]}%}[up]%{$reset_color%}"
    fi
  fi

  echo "$branch$pushed"
}

RPROMPT='`git-prompt`%{$fg_bold[cyan]%}[%~]%{$reset_color%}'
setopt prompt_subst
```

ç§ã®è¶£å‘³ã§ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å³ã«ã‚·ã‚¢ãƒ³ã§è¡¨ç¤ºã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚’å·¦ã«ã™ã‚‹ãªã‚Šè¡Œã‚’ã‚ã‘ã‚‹ãªã‚Šã€å¥½ãã«è¨­å®šã™ã‚Œã°è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚ã¡ãªã¿ã«æœ€å¾Œã®`setopt prompt_subst`ã¯ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ä¸­ã®å¤‰æ•°ã‚’è¡¨ç¤ºæ™‚ã«å±•é–‹ã™ã‚‹ã‚‚ã®ã§ã™ã€‚

## ã¾ã¨ã‚

Zshã§Gitãƒªãƒã‚¸ãƒˆãƒªã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚å¿…è¦æœ€ä½é™ã®çŠ¶æ…‹è¡¨ç¤ºãªã‚‰30è¡Œã¡ã‚‡ã£ã¨ã§æ›¸ã‘ã¡ã‚ƒã†ã®ã§ã€ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«æ…£ã‚Œã¦ã„ãªã„äººã¯ã€ã“ã®æ©Ÿä¼šã«ã„ã‚ã„ã‚éŠã‚“ã§è¦‹ã‚‹ã¨é¢ç™½ã„ã‚“ã˜ã‚ƒãªã„ã§ã—ã‚‡ã†ã‹ã€‚

## å‚è€ƒæ–‡çŒ®

* [get current branch name](https://qiita.com/sugyan/items/83e060e895fa8ef2038c)
* [.zshrcã§è¦‹ã‹ã‘ã‚‹autoloadã®æ„å‘³ã¨ä½¿ã„æ–¹](https://qiita.com/yuku_t/items/77c23390e52168a2754a)
