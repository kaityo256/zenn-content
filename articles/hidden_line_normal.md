---
title: "隠線処理の話"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Python, 数学, math]
published: false
---

## 概要

こんな感じに3次元の立体を2次元に描画するときに線が隠れるようにする処理の話です。

![rotate.gif](/images/hidden_line_normal/rotate.gif)

## はじめに

3次元の物体を2次元に射影することを考えます。例えば立方体を描画するとこんな感じになります。

![fig1](/images/hidden_line_normal/fig1.png)

ここでは立方体の辺が針金でできているかのように全て見えていますが、もしこの物体の中身が詰まっていて不透明なら以下のように見えるでしょう。

![fig2](/images/hidden_line_normal/fig2.png)

先ほどの場合と比較して、三本の線が消えました。このように「こういう状況なら見えないはず」という条件を計算し、見えない部分を描かないようにするのが隠線処理です。

隠線処理にはいろいろなアルゴリズムがあります。簡単なのは、奥から面を描画していき、上書きしていく方法です。これを塗り重ね法と呼びます。この方法は簡単ですが、この立方体の内部にさらに物体があったりする場合に対応できません。

今回、分子動力学シミュレーションの実行結果の可視化に使いたい、というニーズがあり、「空間にあるワイヤーフレーム状の直方体の中に多数の球がある」という状態を描画する必要がありました。例えば、立方体の中に一つだけ大きな球があるとこんな感じになります。

![fig3](/images/hidden_line_normal/fig3.png)

このような描画を行うためには、

1. 球の後ろにある線を描画する
  ![fig4a](/images/hidden_line_normal/fig4a.png)
2. その上に球を描画する
  ![fig4b](/images/hidden_line_normal/fig4b.png)
3. さらにその上に残りの線を描画する
  ![fig3](/images/hidden_line_normal/fig3.png)

みたいなことをする必要があります。要するに、空間に浮いている立方体(直方体)の辺のうち、視線から見て後ろ側にあるか、前側にあるかを判定する必要があるということです。

このように、与えられた立体の辺のうち、どの辺が「向こう側」にあり、どの辺が「こちら側」にあるかを判定するアルゴリズムが法線ベクトル法です。法線ベクトル法は、凸多面体にしか使えませんが、アルゴリズムが単純なので、今回はこれを採用しました。

## 法線ベクトル法の原理

